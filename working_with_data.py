from datetime import date
import pandas as pd

rly_mapping = {
    1: ('CENTRAL RAILWAY', 'CR'),
    2: ('EASTERN RAILWAY', 'ER'),
    3: ('NORTHERN RAILWAY', 'NR'),
    4: ('NORTH EASTERN RAILWAY', 'NER'),
    5: ('NORTH FRONTIER RAILWAY', 'NFR'),
    6: ('SOUTHERN RAILWAY', 'SR'),
    7: ('SOUTH EASTERN RAILWAY', 'SER'),
    8: ('WESTERN RAILWAY', 'WR'),
    9: ('SOUTH CENTRAL RAILWAY', 'SCR'),
    30: ('EAST CENTRAL RAILWAY', 'ECR'),
    31: ('EAST COAST RAILWAY', 'ECOR'),
    32: ('NORTH CENTRAL RAILWAY', 'NCR'),
    33: ('NORTH WESTERN RAILWAY', 'NWR'),
    34: ('SOUTHEAST CENTRAL RAILWAY', 'SECR'),
    35: ('SOUTH WESTERN RAILWAY', 'SWR'),
    36: ('WEST CENTRAL RAILWAY', 'WCR')
}

au_mapping = {
    '0101': 'CENTRAL RAILWAY',
    '0102': 'BOMBAY DIVISION',
    '0103': 'BSL',
    '0106': 'NGP',
    '0107': 'SR.DFM, SHOLAPUR',
    '0109': 'SR.DFM, PUNE',
    '0111': 'NKRD',
    '0112': 'WAO MATUNGA',
    '0113': 'WAO PAREL',
    '0115': 'BSL WS',
    '0116': 'WAAO MANMAD',
    '0121': 'CSTMC',
    '0122': 'DDRC',
    '0125': 'NGPC',
    '0126': 'SAO(C) PUNE',
    '0128': 'SAO(C) BHUSAVAL',
    '0130': 'SURC',
    '0131': 'FA & CAO DC-AC CONVERSION',
    '0132': 'SAO(C) JUINAGAR',
    '0201': 'EASTERN-RLY-HQ',
    '0202': 'EASTERN-RLY-HWH',
    '0203': 'EASTERN-RLY-SDAH',
    '0204': 'EASTERN-RLY-ASN',
    '0205': 'EASTERN-RLY-MLDT',
    '0211': 'EASTERN-RLY-BGP-CONS',
    '0212': 'EASTERN-RLY-TA',
    '0206': 'EASTERN-RLY-LLH',
    '0207': 'EASTERN-RLY-KPA',
    '0208': 'EASTERN-RLY-JMP',
    '0209': 'EASTERN-RLY-HQ-CONS',
    '0210': 'EASTERN-RLY-ASN-CONS',
    '0301': 'NR HEADQUARTER',
    '0303': 'DELHI DIVISION',
    '0304': 'FIROZPUR DIVISION',
    '0306': 'LUCKNOW DIVISION (NR)',
    '0307': 'MORADABAD DIVISION',
    '0323': 'STORES HEADQUARTER (NR)',
    '0325': 'AMABALA DIVISION',
    '0327': 'POL HEADQUARTER (NR)',
    '0328': 'TRAFFIC ACCOUNTS (NR)',
    '0308': 'ALAMBAGH WORKSHOP (NR)',
    '0309': 'AMRITSAR WORKSHOP',
    '0311': 'CHARBAGH WORKSHOP',
    '0312': 'GHAZIABAD WORKSHOP',
    '0313': 'JAGADHARI WORKSHOP',
    '0320': 'CONSTRUCTION DELHI (NR)',
    '0329': 'CONSTRUCTION JAMMU (NR)',
    '0330': 'CONSTRUCTION LUCKNOW (NR)',
    '0401': 'GORAKHPUR',
    '0402': 'VARANASI',
    '0403': 'LUCKNOW',
    '0404': 'IZZATNAGAR',
    '0405': 'WS-IZZATNAGAR',
    '0406': 'WS-GORAKHPUR',
    '0407': 'CON-GORAKHPUR',
    '0408': 'IZN CASH OFFICE',
    '0501': 'NFR HQ',
    '0502': 'KIR',
    '0503': 'APDJ',
    '0504': 'LMG',
    '0505': 'TSK',
    '0506': 'WORSHOP GKP',
    '0516': 'NJP',
    '0511': 'DBRTWS',
    '0512': 'NBQWS',
    '0561': 'MLGC',
    '0563': 'SCLC',
    '0565': 'NJPC',
    '0566': 'JPZC',
    '0601': 'SRHQ',
    '0602': 'MAS',
    '0603': 'TPJ',
    '0604': 'MDU',
    '0605': 'WORSHOP GKP',
    '0606': 'SA',
    '0621': 'TVC',
    '0608': 'PERWS',
    '0609': 'GOCWS',
    '0618': 'PTJWS',
    '0611': 'MSC',
    '0612': 'ERNC',
    '0613': 'TPJC',
    '0615': 'MDUC',
    '0701': 'SER HQRS-GRC',
    '0702': 'KGP DIVISION',
    '0703': 'ADRA DIVISION',
    '0704': 'CKP DIVISION',
    '0705': 'RANCHI DIVISION',
    '0707': 'WORKSHOP KGP',
    '0711': 'CONSTRUCTION GRC',
    '0801': 'WR HEADQUARTERS',
    '0811': 'MUMBAI CENTRAL',
    '0812': 'VADODARA DIVISION',
    '0813': 'RATLAM DIVISION',
    '0817': 'BHAVNAGAR DIVISION',
    '0818': 'RAJKOT DIVISION',
    '0819': 'AHMEDABAD DIVISION',
    '0841': 'NAIR VADODARA',
    '0821': 'PAREL WORKSHOP',
    '0822': 'SABARMATI WORKSHOP',
    '0823': 'DAHOD WORKSHOP',
    '0825': 'PRATAPNAGAR WORKSHOP',
    '0827': 'BHAVNAGAR WORKSHOP',
    '0830': 'S AND C, MUMBAI',
    '0831': 'S AND C RTM',
    '0834': 'S AND C, AHEMADABAD ADIC',
    '0840': 'TRAFFIC ACCOUNT AJMER',
    '0901': 'SCR HEAD QUARTERS',
    '0905': 'SECUNDERABAD DIVISON',
    '0906': 'HYDERABAD DIVISION',
    '0907': 'VIJAYAWADA DIVISON',
    '0909': 'GUNTAKAL DIVISION',
    '0910': 'GUNTUR DIVISION',
    '0911': 'WORSHOP GKP',
    '0915': 'LALLAGUDA WORKSHOP',
    '0917': 'RAYALPADU WORKSHOP',
    '0918': 'TIRUPATI WORKSHOP',
    '0921': 'CONST SECUNDERABAD',
    '0922': 'CONST VIJAYAWADA',
    '0926': 'CONST TIRUPATI',
    '0927': 'CONST NANDED',
    '9001': 'ECR HQ',
    '9002': 'SEE',
    '9003': 'DHN',
    '9004': 'DNR',
    '9005': 'MGS',
    '9008': 'MGSPD',
    '9010': 'HJPCB',
    '9006': 'SPJWS',
    '9017': 'HJPWS',
    '9007': 'PNBEC',
    '3101': 'ECOR HQ',
    '3102': 'KHURDHA DIVISION',
    '3103': 'SAMBELPUR',
    '3104': 'WALTER DIVISION',
    '3105': 'WORKSHOPMCS',
    '3106': 'CONSTRUCTION BBSR',
    '3107': 'CON JJKR ECOR',
    '3108': 'CON SBP',
    '3109': 'VSKPC',
    '3131': 'TABBS ECOR',
    '3201': 'NCR HEAD QUARTER',
    '3202': 'NCR ALLAHABAD DIVISION',
    '3203': 'NCR JHANSI DIVISION',
    '3204': 'NCR AGRA DIVISION',
    '3210': 'NCR IRPMU',
    '3207': 'NCR WORKSHOP JHS',
    '3208': 'NCR WORKSHOP SITHOLI',
    '3205': 'NCR CONSTRUCTION ALD',
    '3206': 'NCR CONS. JHANSI',
    '3209': 'ALDCSPC',
    '3212': 'NCR SAB ALD',
    '3213': 'NCR CONSTRUCTION AGRA',
    '3211': 'NCR TRAFFIC ACCOUNTS ALD',
    '3401': 'JAIPUR HQ',
    '3402': 'NWR JAIPUR DIV',
    '3403': 'NWR AJMER DIV',
    '3404': 'NWR JODHPUR DIV',
    '3405': 'NWR BIKANER DIV',
    '3406': 'NWR AJMER WORKSHOP',
    '3407': 'NWR JODHPUR WORKSHOP',
    '3408': 'NWR BIKANER WORKSHOP',
    '3409': 'NWR CONS JAIPUR',
    '3410': 'NWR CONST JODHPUR',
    '3411': 'NWR CONST BIKANER',
    '3412': 'NWR CONST AJMER',
    '3413': 'NWR TRAFFIC ACC JODHPUR',
    '3414': 'NWR TRAFFIC ACC AJMER',
    '3415': 'NWR STORE HQ JAIPUR',
    '9401': 'RCTWS',
    '9402': 'BSP',
    '9403': 'R',
    '9405': 'NGP',
    '9404': 'RCTWS',
    '9406': 'SBPC',
    '9407': 'SECRTA',
    '3501': 'SWR HQ',
    '3505': 'UBL',
    '3506': 'SBC',
    '3507': 'MYS',
    '3511': 'UBLWS',
    '3512': 'MYSWS',
    '3521': 'SBCC',
    '3502': 'SWRTA',
    '3503': 'UBLSTORE',
    '3601': 'WCR HEAD QUARTERS',
    '3602': 'JABALPUR DIVISION',
    '3603': 'BHOPAL DIVISION',
    '3604': 'KOTA DIVISION',
    '3605': 'WAO BHOPAL',
    '3606': 'WAO KOTA',
    '3607': 'WORSHOP GKP',
    '3608': 'CONSTRUCTION JBP',
    '3609': 'CONSTRUCTION KOTA'
}


cris_df2=pd.read_excel("E:/RIYA_PERSONAL/CS/CRIS/Railway_Expenditure_Analysis/ACFINDBTXN_DATA_TABLE.xlsx")
cris_df2 = cris_df2.drop('PU', axis=1) #PU column is not getting used
cris_df2['AU'] = cris_df2['AU'].astype(str).str.zfill(4) #padding the AU 

#converting to required data type
cris_df2['RLYCODE'] = cris_df2['RLYCODE'].astype('category')
cris_df2['AU'] = cris_df2['AU'].astype('category')
cris_df2['ACCYEARMONTH'] = pd.to_datetime(cris_df2['ACCYEARMONTH'], format='%Y%m')
cris_df2['DEMAND'] = cris_df2['DEMAND'].astype('int16')
#cris_df2['FINYEAR'] = cris_df2['FINYEAR'].astype('category')
cris_df2['AMOUNT'] = cris_df2['AMOUNT'].astype('float32')
cris_df2['DATA_TYPE'] = cris_df2['DATA_TYPE'].astype('category')


#making the AU name and railway name columns
cris_df2['RailwayName'] = cris_df2['RLYCODE'].map(lambda x: rly_mapping.get(x, ('Unknown', 'Unknown'))[0])
cris_df2['AlphaCode'] = cris_df2['RLYCODE'].map(lambda x: rly_mapping.get(x, ('Unknown', 'Unknown'))[1])

cris_df2['AUName'] = cris_df2['AU'].map(au_mapping)
cris_df2['AUName'] = cris_df2['AUName'].fillna('unknown')

#making the start and end date columns
# Split the 'FINYEAR' column into two separate columns for the start year and end year
cris_df2[['START_YEAR', 'END_YEAR']] = cris_df2['FINYEAR'].str.split('-', expand=True)
# Convert the start year and end year columns to integers
cris_df2['START_YEAR'] = cris_df2['START_YEAR'].astype(int)
cris_df2['END_YEAR'] = cris_df2['END_YEAR'].astype(int)

#converting new columns to required datatypes
cris_df2['AUName'] = cris_df2['AUName'].astype('category')
cris_df2['RailwayName'] = cris_df2['RailwayName'].astype('category')
cris_df2['AlphaCode'] = cris_df2['AlphaCode'].astype('category')

#converting data into CSV file to be used later
cris_df2.to_csv('index_data_csv', index=False)